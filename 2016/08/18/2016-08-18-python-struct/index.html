<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">

    <title>Aelous | struct.pack 占用空间问题 </title>
    <meta name="description" content="">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    

    <!-- fonts -->
    <link href="//fonts.googleapis.com/css?family=Source+Sans+Pro:400,700" rel="stylesheet">
    <link href="//fonts.googleapis.com/css?family=Ubuntu:300,400,500,600,700" rel="stylesheet">

    <!-- stylesheets -->
    <link rel="stylesheet" href="/style/doc.css">

    <!-- favicon -->
    <link rel="icon" href="/favicon.ico">

    

  </head>
  <body>

   <script>window.__INITIAL_STATE__ = {"page":{"title":"struct.pack 占用空间问题","path":"2016/08/18/2016-08-18-python-struct/"},"data":{},"config":{"timezone":null,"root":"/","time_format":"HH:mm:ss","theme":"doc","theme_config":{"swagger_ui":{"version":2,"permalinks":true,"api_explorer":true,"download":"Download specification","show_extensions":false,"deep_linking":true,"display_operation_id":false,"doc_expansion":"none"},"search":{"skip":false,"background":false,"route":"/lunr.json"},"favicon":"/favicon.ico"}}}</script>

    <div id="react-navigation-root"><div class="doc-navigation" data-reactroot=""><nav class="doc-navbar"><i class="dc-icon dc-icon--close dc-icon--interactive doc-sidebar-close doc-navbar__sidebar-close doc-navbar__sidebar-close--desktop"></i><i class="dc-icon dc-icon--menu dc-icon--interactive doc-sidebar-toggle doc-navbar__sidebar-toggle"></i></nav><nav class="doc-sidebar"><div class="doc-sidebar__vertical-menu"><i class="dc-icon dc-icon--menu dc-icon--interactive doc-sidebar-toggle doc-sidebar-toggle--primary doc-sidebar__vertical-menu__item"></i><i class="dc-icon dc-icon--search dc-icon--interactive doc-sidebar__vertical-menu__item doc-sidebar__vertical-menu__item--primary"></i></div><div class="doc-sidebar-content"><div class="doc-sidebar__search-form"></div><ul class="doc-sidebar-list"></ul></div></nav></div></div>
    <div class="doc-content">
  <div class="dc-page">
    <div class="dc-card">
      <div id="react-search-results-root"></div>
      <div id="page-content" class="doc-formatting">
        <p>当我使用python.pack为SMGP编写协议时，当编写Login数据包时，需要传递30个字节流，‘8S16SBIB’，但经过</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">struct.pack(<span class="string">'8s16sBIB'</span>,val...)</div></pre></td></tr></table></figure>
<p>得出来的却总是33，经过长时间的尝试发现如下问题：<br>当pack单个char时</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">struct.pack(<span class="string">'c'</span>, str)</div></pre></td></tr></table></figure>
<p>得到的长度是1，但当pack混合的类型时</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">struct.pack(<span class="string">'ic'</span>, int1,char1)</div></pre></td></tr></table></figure>
<p>按理说应该是4，但得到的却是8.</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div></pre></td><td class="code"><pre><div class="line">struct.calcsize(<span class="string">'b'</span>)</div><div class="line"><span class="number">1</span></div><div class="line">struct.calcsize(<span class="string">'i'</span>)</div><div class="line"><span class="number">4</span></div><div class="line">struct.calcsize(<span class="string">'bi'</span>)</div><div class="line"><span class="number">8</span></div></pre></td></tr></table></figure>
<p>原因：<br>struct.pack通常用来访问内存结构，而不是文件。在内存里，当访问的数据占用的是奇数字节或者非对齐的地址时可能会导致异常或性能损失。<br>这就是为什么编译器总是会对齐地址，python的<a href="https://docs.python.org/2/library/struct.html?highlight=struct#module-struct" target="_blank" rel="external">struct</a>模块也是这样做的.<br>如果不想让它自动对齐，可以在格式的前面加上’=’来设置字节顺序。</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">struct.pack(<span class="string">'=ci'</span>, char1, int1)</div><div class="line"><span class="number">5</span></div></pre></td></tr></table></figure>
<p>如果没有指定任何东西，可以用一个隐含的符号’@’，表示本地字节顺序，大小和对齐方式</p>

        <div id="react-support-footer-root"></div>
      </div>
    </div>
  </div>
</div>

    


    

    <!-- js vendors -->
    <script src="//code.jquery.com/jquery-3.2.1.min.js" crossorigin="anonymous"></script>
    <script src="//cdnjs.cloudflare.com/ajax/libs/lunr.js/2.1.0/lunr.min.js"></script>

    <!-- js source  -->
    <script src="/script/doc.js"></script>

    

  </body>
</html>
